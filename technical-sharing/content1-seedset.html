<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How Seed Fixing Affects LLM Sampling</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', sans-serif; background: #0f1117; color: #e0e0e0; min-height: 100vh; }
  
  h1 { text-align: center; padding: 30px 20px 10px; font-size: 1.4rem; color: #fff; font-weight: 600; }
  .subtitle { text-align: center; color: #888; font-size: 0.85rem; margin-bottom: 30px; }

  .container { max-width: 1100px; margin: 0 auto; padding: 0 20px 60px; }

  /* SECTION TABS */
  .tabs { display: flex; gap: 8px; margin-bottom: 30px; justify-content: center; flex-wrap: wrap; }
  .tab { padding: 8px 20px; border-radius: 20px; border: 1px solid #333; background: #1a1a2e; color: #888; cursor: pointer; font-size: 0.85rem; transition: all 0.2s; }
  .tab.active { background: #4f46e5; border-color: #4f46e5; color: #fff; }

  .section { display: none; }
  .section.active { display: block; }

  /* PART 1: Single token sampling */
  .sampling-demo { background: #1a1a2e; border-radius: 16px; padding: 28px; margin-bottom: 20px; }
  .sampling-demo h2 { font-size: 1rem; color: #a78bfa; margin-bottom: 6px; }
  .sampling-demo p { font-size: 0.8rem; color: #888; margin-bottom: 20px; }

  .seed-controls { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; margin-bottom: 24px; }
  .seed-btn { padding: 8px 16px; border-radius: 8px; border: 1px solid #333; background: #0f1117; color: #ccc; cursor: pointer; font-size: 0.82rem; transition: all 0.2s; }
  .seed-btn:hover { border-color: #4f46e5; color: #a78bfa; }
  .seed-btn.selected { background: #4f46e5; border-color: #4f46e5; color: #fff; }
  .stochastic-btn { background: #1a1a1a; border-color: #f59e0b; color: #f59e0b; }
  .stochastic-btn:hover { background: #f59e0b22; }
  .stochastic-btn.selected { background: #f59e0b; color: #000; border-color: #f59e0b; }

  .prompt-display { background: #0f1117; border-radius: 10px; padding: 14px 18px; margin-bottom: 20px; font-size: 0.85rem; border-left: 3px solid #4f46e5; }
  .prompt-display span { color: #a78bfa; font-weight: 600; }

  .token-candidates { margin-bottom: 20px; }
  .token-candidates h3 { font-size: 0.78rem; color: #666; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.05em; }
  
  .bar-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
  .token-label { width: 80px; font-size: 0.82rem; color: #ccc; text-align: right; font-family: monospace; }
  .bar-track { flex: 1; height: 28px; background: #0f1117; border-radius: 6px; overflow: hidden; position: relative; border: 1px solid #222; }
  .bar-fill { height: 100%; border-radius: 6px; transition: width 0.5s ease; display: flex; align-items: center; padding-left: 10px; font-size: 0.75rem; color: #fff; font-weight: 600; }
  .bar-fill.purple { background: linear-gradient(90deg, #4f46e5, #7c3aed); }
  .bar-fill.orange { background: linear-gradient(90deg, #f59e0b, #ef4444); }
  .bar-fill.green { background: linear-gradient(90deg, #10b981, #059669); }
  .bar-fill.blue { background: linear-gradient(90deg, #3b82f6, #2563eb); }
  .bar-fill.pink { background: linear-gradient(90deg, #ec4899, #db2777); }

  .selected-token { background: #1e293b; border-radius: 10px; padding: 14px 18px; border: 1px solid #334; }
  .selected-token .label { font-size: 0.75rem; color: #666; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.05em; }
  .selected-token .token { font-size: 1.1rem; font-family: monospace; font-weight: 700; }
  .selected-token .token.fixed { color: #a78bfa; }
  .selected-token .token.random { color: #f59e0b; }
  .selected-token .explanation { font-size: 0.78rem; color: #666; margin-top: 6px; }

  .run-btn { padding: 10px 24px; background: #4f46e5; border: none; border-radius: 8px; color: #fff; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.2s; margin-top: 16px; }
  .run-btn:hover { background: #4338ca; }

  /* PART 2: Multi-turn */
  .conversation-demo { background: #1a1a2e; border-radius: 16px; padding: 28px; }
  .conversation-demo h2 { font-size: 1rem; color: #a78bfa; margin-bottom: 6px; }
  .conversation-demo p { font-size: 0.8rem; color: #888; margin-bottom: 20px; }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  @media (max-width: 700px) { .two-col { grid-template-columns: 1fr; } }

  .convo-panel { background: #0f1117; border-radius: 12px; padding: 16px; }
  .convo-panel .panel-title { font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 14px; font-weight: 700; }
  .convo-panel.fixed .panel-title { color: #a78bfa; }
  .convo-panel.stochastic .panel-title { color: #f59e0b; }

  .chat-bubble { border-radius: 10px; padding: 10px 14px; margin-bottom: 10px; font-size: 0.8rem; line-height: 1.5; opacity: 0; transform: translateY(8px); transition: all 0.4s ease; }
  .chat-bubble.visible { opacity: 1; transform: translateY(0); }
  .chat-bubble.client { background: #1e293b; border-left: 3px solid #3b82f6; color: #cbd5e1; }
  .chat-bubble.framework { background: #1e1e3f; border-left: 3px solid #4f46e5; color: #c4b5fd; }
  .chat-bubble.framework.varied { border-left-color: #f59e0b; color: #fde68a; background: #1c1a0f; }
  .bubble-role { font-size: 0.68rem; color: #555; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.05em; }

  .play-btn { padding: 10px 24px; border: none; border-radius: 8px; color: #fff; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.2s; margin-top: 16px; width: 100%; }
  .play-btn.fixed-btn { background: #4f46e5; }
  .play-btn.fixed-btn:hover { background: #4338ca; }
  .play-btn.stochastic-btn2 { background: #d97706; }
  .play-btn.stochastic-btn2:hover { background: #b45309; }

  /* PART 3: Key Insight */
  .insight-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  @media (max-width: 600px) { .insight-grid { grid-template-columns: 1fr; } }

  .insight-card { background: #1a1a2e; border-radius: 12px; padding: 20px; border: 1px solid #222; }
  .insight-card h3 { font-size: 0.88rem; font-weight: 700; margin-bottom: 10px; }
  .insight-card p { font-size: 0.78rem; color: #888; line-height: 1.6; }
  .insight-card.good { border-top: 3px solid #10b981; }
  .insight-card.good h3 { color: #10b981; }
  .insight-card.bad { border-top: 3px solid #ef4444; }
  .insight-card.bad h3 { color: #ef4444; }
  .insight-card.neutral { border-top: 3px solid #a78bfa; }
  .insight-card.neutral h3 { color: #a78bfa; }

  .chain-viz { background: #1a1a2e; border-radius: 16px; padding: 28px; margin-top: 20px; }
  .chain-viz h2 { font-size: 1rem; color: #a78bfa; margin-bottom: 20px; }
  .chain { display: flex; align-items: center; gap: 0; flex-wrap: wrap; justify-content: center; }
  .chain-node { background: #0f1117; border-radius: 10px; padding: 10px 14px; font-size: 0.75rem; text-align: center; border: 1px solid #333; min-width: 100px; }
  .chain-node.client-node { border-color: #3b82f6; color: #93c5fd; }
  .chain-node.framework-node { border-color: #7c3aed; color: #c4b5fd; }
  .chain-node .node-label { font-size: 0.65rem; color: #555; margin-bottom: 3px; text-transform: uppercase; }
  .chain-arrow { font-size: 1.2rem; color: #444; padding: 0 6px; }
  .chain-arrow.seed-arrow { color: #4f46e5; }

  .seed-marker { font-size: 0.65rem; background: #4f46e533; border: 1px solid #4f46e5; color: #a78bfa; padding: 2px 6px; border-radius: 4px; margin-top: 4px; display: inline-block; }
  .no-seed-marker { font-size: 0.65rem; background: #f59e0b22; border: 1px solid #f59e0b; color: #fbbf24; padding: 2px 6px; border-radius: 4px; margin-top: 4px; display: inline-block; }
</style>
</head>
<body>

<h1>How Seed Fixing Affects LLM Output</h1>
<p class="subtitle">An interactive explainer for inference techniques</p>

<div class="container">

  <div class="tabs">
    <div class="tab active" onclick="showSection('s1', this)">â‘  Single Token Sampling</div>
    <div class="tab" onclick="showSection('s2', this)">â‘¡ Multi-Turn Conversation</div>
    <div class="tab" onclick="showSection('s3', this)">â‘¢ When Seed-Fixing Breaks</div>
  </div>

  <!-- SECTION 1 -->
  <div class="section active" id="s1">
    <div class="sampling-demo">
      <h2>Token Sampling with Fixed vs. Stochastic Seed</h2>
      <p>The model computes a probability distribution over candidate next tokens. The seed controls which token gets sampled from that distribution.</p>

      <div class="seed-controls">
        <span style="font-size:0.8rem;color:#666;">Choose seed:</span>
        <button class="seed-btn selected" onclick="setSeed(42, this)">Seed = 42</button>
        <button class="seed-btn" onclick="setSeed(7, this)">Seed = 7</button>
        <button class="seed-btn" onclick="setSeed(123, this)">Seed = 123</button>
        <button class="seed-btn stochastic-btn" onclick="setSeed('random', this)">No Seed (Random)</button>
      </div>

      <div class="prompt-display">
        <span>Prompt:</span> "I've been feeling really anxious lately and I don't know what to do. The next word I'd say is..."
      </div>

      <div class="token-candidates">
        <h3>Candidate next tokens & probabilities</h3>
        <div class="bar-row">
          <div class="token-label">"maybe"</div>
          <div class="bar-track"><div class="bar-fill purple" id="bar0" style="width:38%">38%</div></div>
        </div>
        <div class="bar-row">
          <div class="token-label">"honestly"</div>
          <div class="bar-track"><div class="bar-fill green" id="bar1" style="width:27%">27%</div></div>
        </div>
        <div class="bar-row">
          <div class="token-label">"I"</div>
          <div class="bar-track"><div class="bar-fill blue" id="bar2" style="width:18%">18%</div></div>
        </div>
        <div class="bar-row">
          <div class="token-label">"nothing"</div>
          <div class="bar-track"><div class="bar-fill pink" id="bar3" style="width:11%">11%</div></div>
        </div>
        <div class="bar-row">
          <div class="token-label">"everything"</div>
          <div class="bar-track"><div class="bar-fill orange" id="bar4" style="width:6%">6%</div></div>
        </div>
      </div>

      <div class="selected-token">
        <div class="label">Sampled Token</div>
        <div class="token fixed" id="sampled-token">"maybe"</div>
        <div class="explanation" id="sampled-explanation">Seed 42 always picks this token â†’ same output every run</div>
      </div>

      <button class="run-btn" onclick="runSample()">â–¶ Sample Again</button>
    </div>
  </div>

  <!-- SECTION 2 -->
  <div class="section" id="s2">
    <div class="conversation-demo">
      <h2>How Seed Propagates Through a Multi-Turn Session</h2>
      <p>Notice how the framework's response shapes the client's next message â€” the conversation is co-produced. See what changes when the seed is fixed vs. free.</p>

      <div class="two-col">
        <div class="convo-panel fixed">
          <div class="panel-title">ðŸ”’ Fixed Seed (seed=42)</div>
          <div id="fixed-chat"></div>
          <button class="play-btn fixed-btn" onclick="playConvo('fixed')">â–¶ Run Session</button>
        </div>
        <div class="convo-panel stochastic">
          <div class="panel-title">ðŸŽ² No Fixed Seed (Random)</div>
          <div id="stochastic-chat"></div>
          <button class="play-btn stochastic-btn2" onclick="playConvo('stochastic')">â–¶ Run Session</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 3 -->
  <div class="section" id="s3">

    <div class="chain-viz">
      <h2>The Coupled Chain Problem</h2>
      <div class="chain">
        <div class="chain-node client-node">
          <div class="node-label">Client Turn 1</div>
          "I feel anxious"
          <div class="no-seed-marker">stochastic</div>
        </div>
        <div class="chain-arrow">â†’</div>
        <div class="chain-node framework-node">
          <div class="node-label">Framework Turn 1</div>
          "Tell me more..."
          <div class="seed-marker">seed=42</div>
        </div>
        <div class="chain-arrow">â†’</div>
        <div class="chain-node client-node">
          <div class="node-label">Client Turn 2</div>
          <em style="color:#555">shaped by T1 â†‘</em>
          <div class="no-seed-marker">stochastic</div>
        </div>
        <div class="chain-arrow">â†’</div>
        <div class="chain-node framework-node">
          <div class="node-label">Framework Turn 2</div>
          <em style="color:#555">shaped by T2 â†‘</em>
          <div class="seed-marker">seed=42?</div>
        </div>
      </div>
      <p style="font-size:0.78rem;color:#555;text-align:center;margin-top:16px;">Even if you fix the framework seed, the client's stochastic responses change what the framework receives â€” so the trajectory diverges anyway.</p>
    </div>

    <div style="margin-top: 20px;">
      <div class="insight-grid">
        <div class="insight-card good">
          <h3>âœ“ Seed-fixing works well when...</h3>
          <p>Each model call is <strong>independent</strong>. Single-response evaluation, prompt A/B testing, summarization benchmarks, classification tasks â€” no prior context shapes the output.</p>
        </div>
        <div class="insight-card bad">
          <h3>âœ— Seed-fixing misleads when...</h3>
          <p>You're evaluating a <strong>multi-turn interactive system</strong>. Conversation trajectories are co-produced â€” fixing one side's seed doesn't control the full system.</p>
        </div>
        <div class="insight-card neutral">
          <h3>â†’ Better strategy for interactive systems</h3>
          <p><strong>Scenario-level reproducibility.</strong> Fix the client persona, emotional state, and starting conditions. Let the conversation unfold. Run multiple sessions. Report variance across personas.</p>
        </div>
        <div class="insight-card neutral">
          <h3>â†’ What this means for your experiments</h3>
          <p>Reproducibility lives in your <strong>experimental design</strong>, not the random seed. A well-specified persona is more meaningful â€” and more interpretable â€” than seed=42.</p>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  let currentSeed = 42;

  const seedTokenMap = {
    42: { token: '"maybe"', color: 'fixed', explanation: 'Seed 42 always picks this token â†’ same output every run' },
    7:  { token: '"honestly"', color: 'fixed', explanation: 'Seed 7 always picks this token â†’ same output every run' },
    123:{ token: '"I"', color: 'fixed', explanation: 'Seed 123 always picks this token â†’ same output every run' },
    'random': null
  };

  const randomTokens = [
    { token: '"maybe"', explanation: 'Random draw landed here this run â€” could be different next time' },
    { token: '"honestly"', explanation: 'Random draw landed here this run â€” could be different next time' },
    { token: '"nothing"', explanation: 'Random draw landed here this run â€” could be different next time' },
    { token: '"everything"', explanation: 'Random draw landed here this run â€” could be different next time' },
    { token: '"I"', explanation: 'Random draw landed here this run â€” could be different next time' },
  ];

  function setSeed(seed, btn) {
    currentSeed = seed;
    document.querySelectorAll('.seed-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    runSample();
  }

  function runSample() {
    const el = document.getElementById('sampled-token');
    const exp = document.getElementById('sampled-explanation');
    if (currentSeed === 'random') {
      const pick = randomTokens[Math.floor(Math.random() * randomTokens.length)];
      el.textContent = pick.token;
      el.className = 'token random';
      exp.textContent = pick.explanation;
    } else {
      const pick = seedTokenMap[currentSeed];
      el.textContent = pick.token;
      el.className = 'token fixed';
      exp.textContent = pick.explanation;
    }
  }

  // Multi-turn conversations
  const fixedConvo = [
    { role: 'client', text: 'I\'ve been feeling really anxious and don\'t know what to do.' },
    { role: 'framework', text: 'I hear you. Can you tell me more about when this anxiety tends to show up?' },
    { role: 'client', text: 'Mostly at work. My boss piles on too much.' },
    { role: 'framework', text: 'That sounds overwhelming. Have you been able to set any boundaries around your workload?' },
    { role: 'client', text: 'Not really. I just don\'t know how to say no.' },
    { role: 'framework', text: 'That\'s a really common struggle. Let\'s explore what makes saying no feel difficult for you.', varied: false },
  ];

  const stochasticConvos = [
    [
      { role: 'client', text: 'I\'ve been feeling really anxious and don\'t know what to do.' },
      { role: 'framework', text: 'It takes courage to reach out. What does the anxiety feel like in your body?', varied: true },
      { role: 'client', text: 'Like a tight chest. It happens randomly, not just at work.' },
      { role: 'framework', text: 'Anxiety that feels physical and unpredictable can be really distressing. How long has this been going on?', varied: true },
      { role: 'client', text: 'A few months now, since a big life change.' },
      { role: 'framework', text: 'Big transitions often bring this on. What changed a few months ago, if you\'re comfortable sharing?', varied: true },
    ],
    [
      { role: 'client', text: 'I\'ve been feeling really anxious and don\'t know what to do.' },
      { role: 'framework', text: 'I\'m glad you\'re talking about it. Is this a recent feeling or has it been building for a while?', varied: true },
      { role: 'client', text: 'It\'s been building. I think I\'ve been ignoring it.' },
      { role: 'framework', text: 'Sometimes we push things down until they demand attention. What finally made you want to address it today?', varied: true },
      { role: 'client', text: 'I had a panic attack yesterday. It scared me.' },
      { role: 'framework', text: 'That must have been frightening. You\'re doing the right thing by not letting it go unaddressed.', varied: true },
    ]
  ];

  let stochasticRun = 0;

  function playConvo(type) {
    const containerId = type === 'fixed' ? 'fixed-chat' : 'stochastic-chat';
    const container = document.getElementById(containerId);
    container.innerHTML = '';

    const convo = type === 'fixed' ? fixedConvo : stochasticConvos[stochasticRun % 2];
    if (type === 'stochastic') stochasticRun++;

    convo.forEach((turn, i) => {
      setTimeout(() => {
        const bubble = document.createElement('div');
        bubble.className = `chat-bubble ${turn.role}${turn.varied ? ' varied' : ''}`;
        bubble.innerHTML = `<div class="bubble-role">${turn.role === 'client' ? 'ðŸ‘¤ Client' : 'ðŸ¤– Framework'}</div>${turn.text}`;
        container.appendChild(bubble);
        requestAnimationFrame(() => bubble.classList.add('visible'));
        container.scrollTop = container.scrollHeight;
      }, i * 900);
    });
  }

  function showSection(id, tab) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    tab.classList.add('active');
  }
</script>
</body>
</html>